@namespace BlazorUI
@page "/SVGTestPage"
@using LazyMagic.BlazorSvg

<PageTitle>SVGTest</PageTitle>

<h1>SVGTestPage</h1>

<div class="alert alert-info mb-3">
    <strong>Real-time Selection Test:</strong> This page demonstrates SVG real-time selection and bounding box functionality.
    <br />
    <strong>Initial State:</strong> Starting with paths "Ballroom_1" and "Ballroom_3" selected.
    <br />
    <strong>Features:</strong> Real-time grouping and bounding box visualization for selected paths.
</div>

<SvgViewer @ref="@svgViewer"
    InitialPaths="@initialPaths"
    SvgUrl="Level1.svg"
    PathsChanged="OnPathsChanged"
    @bind-AllInsideSelected="@allInsideSelected"/>

<div class="mt-3">
    <div>Initial Paths: <code>@(string.Join(", ", initialPaths))</code></div>
    <div>Currently Selected: <code>@(string.Join(", ", currentPaths.Any() ? currentPaths : initialPaths))</code></div>
    <div>All Inside Selected: <strong>@(allInsideSelected ? "✅ YES - All paths within bounding box are selected" : "❌ NO - Some paths within bounding box are NOT selected")</strong></div>
</div>

@if (allInsideSelected)
{
    <div class="alert alert-success mt-2">
        ✅ All paths inside the bounding box are selected! The selection is complete.
    </div>
}
else if (currentPaths.Count > 1 || initialPaths.Count > 1)
{
    <div class="alert alert-warning mt-2">
        ⚠️ Partial selection detected. There are unselected paths within the bounding box created by your selection.
    </div>
}

<div class="mt-4">
    <h5>Test Controls:</h5>
    <div class="row">
        <div class="col-md-6">
            <button class="btn btn-info mb-2" @onclick="TestSelect">TestSelect (Add Ballroom_2)</button>
        </div>
    </div>
</div>

<div class="mt-4">
    <h5>Test Instructions:</h5>
    <ul>
        <li><strong>Real-time Selection:</strong> Click on SVG paths to select/unselect them</li>
        <li><strong>Bounding Box:</strong> Automatically displays around selected paths with overlap detection</li>
        <li><strong>Visual Indicators:</strong> Selected paths change color and bounding box appears</li>
        <li><strong>Auto-grouping:</strong> Real-time grouping visualization shows automatically for selections</li>
    </ul>
</div>

@code {
    private List<string> currentPaths = new();
    private SvgViewer? svgViewer;
    // Initialize with multiple paths that create a bounding box
    // If there are other paths inside this bounding box that aren't selected,
    // AllInsideSelected should be false initially
    private List<string> initialPaths = new List<string> { "Ballroom_1", "Ballroom_3" };
    private bool allInsideSelected = false;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    protected async override Task OnAfterRenderAsync(bool firstRender)
    {
       await base.OnAfterRenderAsync(firstRender);
    }

    private void OnPathsChanged(List<string> paths)
    {
        currentPaths = paths;
    }

    private async Task TestSelect()
    {
        var paths = new List<string> { "Ballroom_2" };
        await svgViewer!.SelectPaths(paths);
    }

}
@namespace BlazorTest
@page "/"
@inherits LzComponentBaseInjectViewModel<ISessionsViewModel>
@inject NavigationManager NavigationManager
@inject ILzClientConfig ClientConfig

@if (ClientConfig.ConfigureError)
{
    <p>Could not read configuration </p>
    <p>@ClientConfig.ConfigError</p>
}
@*
    This page is the first page that is loaded when the app starts. In a POS Muti-User app, this page
    is used to select from a list of available sessions or create a new session. In a Single-User app,
    this page doesn't appear because the session is created automatically.
*@
<div style="width: 9rem; height: 9rem; margin-left: 1rem; margin-top: 1rem;">
    <LzAppLoading AnimationDurationSeconds="1.0"
                  LoadingMessage="Checking for updates." />
</div>

@code {

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (ClientConfig.Configured)
        {
            if (ViewModel!.SessionViewModel is null)
            {
                await ViewModel.CreateSessionAsync();
                ViewModel!.SessionViewModel!.AuthProcess.SetSignUpAllowed(true);
            }
            await Task.Delay(2000); // Simulate a delay for loading
            NavigationManager.NavigateTo("Login");
        }
        await Task.Delay(2000); // Simulate a delay for loading
        await base.OnAfterRenderAsync(firstRender);
    }

}
